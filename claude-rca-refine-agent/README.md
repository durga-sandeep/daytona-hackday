# Claude RCA Refine Agent

A Claude-powered code agent that automatically reads trace logs, analyzes issues, and fixes code using Claude's API.

## Setup

1. Install dependencies:
```bash
npm install
```

2. Set your OpenAI API key:
```bash
export OPENAI_API_KEY=your_api_key_here
```

Or create a `.env` file:
```
OPENAI_API_KEY=your_api_key_here
```

Optional: Set a specific OpenAI model (default: gpt-4o-mini):
```bash
export OPENAI_MODEL=gpt-4o-mini
```

Available models:
- `gpt-4o-mini` (default, recommended, fast and cheap)
- `gpt-4o` (more capable)
- `gpt-4-turbo` (high performance)
- `gpt-4` (original GPT-4)
- `gpt-3.5-turbo` (faster, cheaper)

## Usage

Run the agent with default paths:
```bash
npm start
```

Or specify custom paths:
```bash
node agent.js <trace-log-path> <code-file-path>
```

Example:
```bash
node agent.js ../logs/trace-2025-11-15T21-05-48-877Z.json ../style-scout-ai-main/backend/src/index.js
```

## How it works

1. **Reads trace log** - Loads the trace log JSON file
2. **Analyzes with OpenAI** - Uses OpenAI models to identify issues and root causes
3. **Fixes code** - Uses OpenAI models to generate fixed code
4. **Creates backup** - Saves original file before writing fixes
5. **Applies fixes** - Writes the fixed code to the file

## Features

- Automatic issue detection from trace logs
- Root cause analysis
- Code fixes generated by OpenAI models
- Automatic backup creation
- JSON trace log support
- Detailed error messages and troubleshooting tips

## Troubleshooting

If you encounter connection errors:

1. **Verify API Key**: Make sure `OPENAI_API_KEY` is set correctly
   ```bash
   echo $OPENAI_API_KEY
   ```

2. **Check API Key Format**: Should start with `sk-` and be ~50+ characters

3. **Test API Key**: Visit https://platform.openai.com/api-keys to verify your key is active

4. **Network Issues**: Check your internet connection and firewall settings

5. **Model Name**: If using a custom model, ensure it's a valid OpenAI model name

6. **SDK Version**: Make sure you have the latest SDK:
   ```bash
   npm install openai@latest
   ```

